<!DOCTYPE html>
<html>
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Null Safety in Kotlin</title>
    <link rel="stylesheet" href="..\..\markbind\css\bootstrap.min.css">
    <link rel="stylesheet" href="..\..\markbind\css\bootstrap-vue.min.css">
    <link rel="stylesheet" href="..\..\markbind\css\font-awesome.min.css" >
    <link rel="stylesheet" href="..\..\markbind\css\bootstrap-glyphicons.min.css" >
    <link rel="stylesheet" href="..\..\markbind\css\github.min.css">
    <link rel="stylesheet" href="..\..\markbind\css\markbind.css">
    <link rel="stylesheet" href="..\..\markbind\css\site-nav.css">
    <link rel="stylesheet" href="/learningresources/css/gh-pages.css">
    
</head>
<body>
<div id="app" class="container-fluid">
    <div id="seedu-header">
  <nav class="navbar navbar-lg navbar-expand navbar-light bg-lighter">
    <div class="container">
      <a class="navbar-brand" href="https://se-edu.github.io/"><img src="https://se-edu.github.io/images/SeEduLogo.png" alt="SE-EDU"></a>
      <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link" href="https://se-edu.github.io/addressbook-level1">AB-1</a></li>
        <li class="nav-item"><a class="nav-link" href="https://se-edu.github.io/addressbook-level2">AB-2</a></li>
        <li class="nav-item"><a class="nav-link" href="https://se-edu.github.io/addressbook-level3">AB-3</a></li>
        <li class="nav-item"><a class="nav-link" href="https://se-edu.github.io/addressbook-level4">AB-4</a></li>
        <li class="nav-item"><a class="nav-link" href="https://se-edu.github.io/collate">Collate</a></li>
        <li class="nav-item"><a class="nav-link" href="https://se-edu.github.io/se-book">Book</a></li>
        <li class="nav-item"><a class="nav-link active" href="/learningresources/index.html">Resources</a></li>
      </ul>
    </div>
  </nav>
</div>
<div id="site-header">
  <nav class="navbar navbar-expand navbar-light bg-light">
    <div class="container">
      <a class="navbar-brand" href="/learningresources/index.html">Learning Resources for Software Engineering Students</a>
      <ul class="navbar-nav"></ul>
      <form class="navbar-form">
        <searchbar :data="searchData" placeholder="Search" :on-hit="searchCallback" menu-align-right=""></searchbar>
      </form>
    </div>
  </nav>
</div>
<div class="website-content">
  <h1 id="null-safety-in-kotlin">Null Safety in Kotlin</h1>
  <p>Author: <a href="https://github.com/Haozhe321">Pan Haozhe</a></p>
  <blockquote>
    <p>“I call it my billion-dollar mistake. It was the invention of the null reference…My goal was to ensure that all use of references should be absolutely safe, with <strong>checking performed automatically by the compiler</strong>. But I couldn't resist
      the temptation to put in a null reference, simply because it was so easy to implement.”<br> -Tony Hoare</p>
  </blockquote>
  <p>This document explains Kotlin's null safety feature . For an overview of Kotlin, see <a href="https://github.com/se-edu/learningresources/blob/master/contents/kotlin/kotlin.md">here</a>.</p>
  <h1 id="what-is-null-safety">What is Null Safety?</h1>
  <p><em>Null Safety</em> (or <em>void safety</em>) is the guarantee that no object reference will have a <code>null</code> value. In object-oriented languages, access to objects is achieved through references. A typical function call is of the form <code>object.func()</code>;
    <code>object</code> denotes a reference to a certain object, and <code>func</code> denotes a function call. At execution time, the reference to <code>object</code> can be <code>void</code>, leading to run-time exceptions (In the case of Java, a NullPointerException)
    and often abnormal termination of the program.</p>
  <h2 id="nullpointerexception">NullPointerException</h2>
  <p>When developing Android applications in Java, <a href="https://docs.oracle.com/javase/9/docs/api/java/lang/NullPointerException.html">NullPointerException (NPE)</a> was a big problem. In fact, About <a href="https://image.slidesharecdn.com/droidcon-bugsense-130408170720-phpapp01/95/droid-con-bugsense-16-638.jpg?cb=1365440918">one third of app crashes can be attributed to NPE</a>.
    To see how it happens, let's take a look at the piece of Java code below:</p>
  <pre><code class="hljs java">String a = <span class="hljs-keyword">null</span>;
<span class="hljs-keyword">if</span>(a.length &gt; <span class="hljs-number">5</span>) {
    <span class="hljs-comment">//do something</span>
}
</code></pre>
  <p>When the above code is run, an NPE will be thrown on line 2 because a <code>null</code> object has no methods. To prevent an object from taking on a <code>null</code> value, programmers typically resort to doing additional checks like this:</p>
  <pre><code class="hljs java">String a = <span class="hljs-keyword">null</span>;
<span class="hljs-keyword">if</span>(a != <span class="hljs-keyword">null</span> &amp;&amp; a.length &gt; <span class="hljs-number">5</span>) {
        <span class="hljs-comment">//do something</span>
}
</code></pre>
  <p>And of course, that's all fine, until we want to do something more complex. Say Bob belongs to a department, and we want to get the name of the department manager. That will look like this:</p>
  <pre><code class="hljs java">String managerName = bob.department.manager.name;
</code></pre>
  <p>Because each variable can be <code>null</code>, to prevent the NPE we put the code in the following code block:</p>
  <pre><code class="hljs java"><span class="hljs-keyword">if</span>(bob != <span class="hljs-keyword">null</span>) {
    Department department = bob.department;
    <span class="hljs-keyword">if</span>(department != <span class="hljs-keyword">null</span>) {
        Employee manager = department.manager;
        <span class="hljs-keyword">if</span>(manager != <span class="hljs-keyword">null</span>) {
            String name = manager.name;
            <span class="hljs-keyword">if</span>(name != <span class="hljs-keyword">null</span>) {
                <span class="hljs-comment">//do something</span>
            }
        }
    }
}
</code></pre>
  <p>The deep-nested <code>if</code> statement reduces readability of our code.</p>
  <p>The other way is to use <a href="http://www.oracle.com/technetwork/articles/java/java8-optional-2175753.html">Java Optionals</a>. For the first example above, we can do</p>
  <pre><code class="hljs java">a.ifPresent(<span class="hljs-keyword">this</span>::doSomething);
</code></pre>
  <p>And for the deeply-nested <code>if</code> statements, the verbosity can be reduced with</p>
  <pre><code class="hljs java">bob.map(Person::getDepartment)
    .map(Person::getManager)
    .map(Person::getName)
    .ifPresent(Person::doSomething);
</code></pre>
  <p><code>map()</code> is a method in Java Optionals class that applies the function inside the parentheses to the object that is calling it. If the object is not present, it will return an empty Optional.</p>
  <p>Let's see how Kotlin deals with this issue while maintaining a simple and readable syntax.</p>
  <h1 id="how-does-kotlin-handle-null-safety">How does Kotlin handle Null Safety?</h1>
  <h2 id="nullable-and-non-nullable-type">Nullable and Non-nullable type</h2>
  <p>In Kotlin, a type can be <em>nullable</em> or <em>non-nullable</em>, determined by the presence of a <code>?</code>. For example, an object of type <code>String</code> is non-nullable, while an object of type <code>String?</code> is nullable.</p>
  <p>As the compiler catches <code>null</code> assignments to non-nullable objects, the following would result in compilation error.</p>
  <pre><code class="hljs Kotlin"><span class="hljs-keyword">var</span> firstString: String = <span class="hljs-string">"hello world"</span>
firstString = <span class="hljs-literal">null</span> <span class="hljs-comment">//compilation error</span>
</code></pre>
  <p>In comparison, the following assignment to a nullable type is allowed</p>
  <pre><code class="hljs Kotlin"><span class="hljs-keyword">var</span> secondString: String? = <span class="hljs-string">"hello world"</span>
secondString = <span class="hljs-literal">null</span> <span class="hljs-comment">//okay</span>
</code></pre>
  <p>In the first case, we can safely call <code>firstString.length</code> without having to worry about a NPE because <code>firstString</code> can never be <code>null</code>.<br> In the second case, <code>secondString</code> can potentially be <code>null</code>,
    so <code>secondString.length</code> will result in a compilation error as the compiler see the danger of such statement and blocks it early.</p>
  <h2 id="safety-operators-in-kotlin">Safety Operators in Kotlin</h2>
  <p>Although non-nullable type is a strong feature in Kotlin, the <a href="https://kotlinlang.org/docs/reference/java-interop.html">interoperability</a> with Java means that we have to use variables as nullable type sometimes. In the previous section, we
    seem to have hit an obstacle as the compiler blocks the call to <code>secondString.length</code>. In this section we look at some ways of overcoming this problem.</p>
  <h3 id="safe-call-operator">Safe call operator</h3>
  <p>Represented by <code>?.</code>, the safe call operator is used in this way</p>
  <pre><code class="hljs kotlin">secondString?.length
</code></pre>
  <p>This returns the length of <code>secondString</code> if <code>secondString</code> is not <code>null</code>, and <code>null</code> otherwise.</p>
  <p>Now we can chain like this</p>
  <pre><code class="hljs Kotlin">bob?.department?.manager?.name
</code></pre>
  <p>This chain will return <code>null</code> if any of the variables inside the chain is <code>null</code>.</p>
  <h3 id="elvis-operators">Elvis Operators</h3>
  <p>Represented by <code>?:</code>, the Elvis operator is used in this way</p>
  <pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> length = secondString?.length ?: <span class="hljs-number">-1</span>
</code></pre>
  <p>If the expression to the left of <code>?:</code> is not null, the Elvis operator (<code>?.</code>) will return it as it is; else it will return a default value supplied (-1 in this case).</p>
  <p>We also notice the use of safe call operator together with Elvis operator in the same statement.</p>
  <p>But the Elvis operator is more powerful than this. <code>return</code> and <code>throw</code> statements are legitimate default values on the right side of the Elvis operator. So you can define your own error message to aid debugging. For example:</p>
  <pre><code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">myFunc</span><span class="hljs-params">(node: <span class="hljs-type">Node</span>)</span></span>: String? {
    <span class="hljs-keyword">val</span> parent = node.getParent() ?: <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
    <span class="hljs-keyword">val</span> name = node.getName() ?: <span class="hljs-keyword">throw</span> IllegalArgumentException(<span class="hljs-string">"Name expected"</span>)
    <span class="hljs-comment">// ...</span>
}
</code></pre>
  <p>Doing so like this can help programmers to check for function arguments before carrying on with the required computation.</p>
  <p>At this point you may ask, &quot;What if I still want my NPE?&quot;</p>
  <h3 id="not-null-assertion-operator">Not-null assertion operator</h3>
  <p>Represented by <code>!!</code>, the not-null assertion operator is used in this way</p>
  <pre><code class="hljs kotlin"><span class="hljs-keyword">val</span> stringLength = secondString!!.length
</code></pre>
  <p>The operator converts any value to a non-nullable type and throws an exception if the value is null. In the above example, <code>stringLength</code> will be assigned the length of <code>secondString</code> if <code>secondString</code> is not <code>null</code>;
    if secondString is <code>null</code>, a NPE is thrown. Kotlin tries to reduce the number of NPEs thrown as it is a run-time exception that is difficult to debug, in addition to creating so many app crashes. Hence NPEs in Kotlin are explicitly asked
    for.</p>
  <h1 id="summary">Summary</h1>
  <ol>
    <li>Kotlin increases null safety of programs because some of the work required to ensure null safety is offloaded from the programmer to the compiler, which is less error prone.</li>
    <li>Null Safety is enforced by the Kotlin language. This is better compared to Java Optionals which is a Class and not a language construct like Kotlin's null-safety system.</li>
    <li>If you expect your object to <strong>not</strong> take on a <code>null</code> value, make it a non-nullable type!</li>
    <li>Even if you make your object a nullable type, Kotlin handles it better than Java because it can help to prevent NPE. An generic NPE is hard to debug; in Kotlin a descriptive message could be given to make debugging easier (with the help of Elvis operator).</li>
  </ol>
  <h1 id="learning-resources">Learning resources</h1>
  <ul>
    <li><a href="https://kotlinlang.org/docs/reference/null-safety.html">Null Safety in Kotlin</a></li>
    <li><a href="http://www.baeldung.com/kotlin-null-safety">Comprehensive Guide to Null Safety in Kotlin</a></li>
    <li><a href="https://www.infoq.com/presentations/Null-References-The-Billion-Dollar-Mistake-Tony-Hoare">The Billion Dollar Mistake</a></li>
  </ul>
</div>
<div id="flex-div"></div>
<footer>
  <div class="text-center">
    <small>[Generated by <a href="https://markbind.github.io/markbind/">MarkBind 1.10.0</a> on Sat, 28 Jul 2018 08:04:24 GMT]</small></div>
</footer>
</div>
</body>
<script src="..\..\markbind\js\vue.min.js"></script>
<script src="..\..\markbind\js\vue-strap.min.js"></script>
<script src="..\..\markbind\js\polyfill.min.js"></script>
<script src="..\..\markbind\js\bootstrap-vue.min.js"></script>
<script>
    const baseUrl = '/learningresources'
</script>
<script src="..\..\markbind\js\setup.js"></script>
</html>
